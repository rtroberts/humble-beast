# Streetlights Downloads
This document will show you how to keep your downloads system up-to-date with the content and images you'd like to provide.

### Buckets
The downloads system uses a single bucket in S3 to deliver content. There are important naming conventions which must be followed to properly handle content. The process is something like this:
- A user makes a request - like `http://dl.streetlights.com/sl/streetlights/streetlights-john`
- The downloads system checks one directory for a file with a name like 'streetlights-john'
- If it finds a file that matches the request, it will deliver that file's page.
- There is also some logic in here to redirect you to the correct page if it finds a filename that is similar to, but not exactly the same as, the one you requested.
- Once you land on the page, it then will attempt to display an image of the same name, which is located in another directory in the same bucket.
-  There are naming conventions for images in particular which must be followed for the content to be handled properly. In this case, it would look for an image called `streetlights-john.jpg`, but more on that later.

##### Downloadable Content
The Streetlights version of this system uses the following bucket for everything: 
```
s3://sl-download-app/
```

For downloadable content, it looks in the following folder:
```
s3://sl-download-app/sources/
```

You'll notice that there are two subdirectories here. Most Streetlights content (the Bible books) are located under `sources/streetlights/*`, but there is some flexibility here to serve up different content if desired. For instance, [this link](http://dl.streetlightsbible.com/sl/albums/alert312-kingdoms-falling-(single)) currently works, since we have that zip file in `sources/albums/`.

##### Images
The downloads system uses the current URL to find images for albums or audiobooks or what-have-you. It checks the following location for those images:
```
s3://sl-download-app/public/img/*.jpg
```

Meaning, it looks for JPG files in that `public/img` directory. In the above example for `http://dl.streetlightsbible.com/sl/streetlights/streetlights-john`, it would look for an image called `streetlights-john.jpg`


## Adding Content - Step by Step
Let's use an example audiobook called "Streetlights 1 & 2 Kings.zip".
1. Upload your Streetlights Audiobook to this location: 
`s3://sl-download-app/sources/streetlights/`
For our example book, that would be:
`s3://sl-download-app/sources/streetlights/Streetlights 1 & 2 Kings.zip`


2. Find the route which has been generated by the downloads system. Usually you can just replace any space with a hyphen for your first try. So I would try to hit `http://dl.streetlightsbible.com/sl/streetlights/streetlights-1-&-2-kings`. 
If that URL is close to the correct one, the site should redirect you to the correct URL. If you get the "Cannot find item" error page, try removing other strange characters, like ampersands (&) and parentheses.
3. Turns out, that's the correct URL. Now that I know the URL, I can upload the Audiobook album artwork JPG. Upload your JPG to this location:
`
s3://sl-download-app/public/img/`
So our example image would be:
`s3://sl-download-app/public/img/streetlights-1-&-2-kings.jpg`
4. You're done!


## Troubleshooting
##### It keeps giving me a "Can't find item" page?
Make sure you've uploaded it to the right `sources/` folder, and that the subfolder is reflected in the URL. If you've uploaded to `sources/albums/`, the url should be something like:
`dl.streetlightsbible.com/sl/albums/x`
##### It's still happening?
Make sure you're trying a URL without spaces. You could try removing special characters from the filename on S3, or from your test URL, or both.
##### My album/audiobook images aren't showing?
A few things:
- Make sure it's a `.jpg` and that it's in the `public/img/` directory.
- Verify it has the correct name - it should be the same as the URL for your download, except with `.jpg` at the end.
